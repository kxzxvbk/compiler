# 语义分析+代码生成（一）

## 编码前设计

​        这次的作业分为两个难度，一个是生成四元式进而生成mips汇编，另一个是生成栈式虚拟机的pcode。这两个中，pcode易于生成，但是四元式方便进一步的化简。我采用了四元式，但是为了生成的便捷性，我采用了pcode作为中间过渡，然后再统一地分配中间变量生成四元式。比如：

y = a + b先化成pcode：

LOD a

LOD b

ADD

ASSIGN y

然后加上中间变量：

t1 = a

t2 = b

t3 = t1 + t2

y = t3

这样的好处是：将比较复杂的、有关中间变量生成的代码从语法分析程序中剥离开来，简化编码难度。

## 编码后设计

​        在实现的过程中，我发现这样做有两个问题导致开销。

​        1、对于y = a + b这种形式的代码，事实上我又开辟了t1, t2的内存空间，这是不必要的。因此可以设置t1指向a的内存空间，t2指向b的内存空间。

​        2、对于y = 1 + 2这种形式的代码，我对立即数也开辟了内存空间，这同样是不必要的。因此可以将t1，t2认为是const类型的常量，从而避免计算。

总而言之，四元式设计如下：

add，mult，sub， div负责四则运算

assign dst, op1表示将op1赋值给dst

allocate size 表示在.data段申请size的空间

lod_off dst， src， offset表示从src的偏移处加载到dst

li dst value表示加载立即数value给dst

print_s string 输出字符串string

print_v_int number 输出整数number

print_v_char ch 输出字符ch

scanf_int dst 输入整数至dst

scanf_char dst输入字符至dst

